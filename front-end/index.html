<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market DAO</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>Market DAO</h1>
            <div class="wallet-connect">
                <button id="connectWalletBtn">Connect Wallet</button>
                <div id="accountInfo" class="hidden">
                    <span id="accountAddress"></span>
                    <span id="accountBalance"></span>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <section id="daoInfo" class="panel">
            <h2>DAO Information</h2>
            <div class="dao-stats">
                <div class="stat-item">
                    <h3>Name</h3>
                    <p id="daoName">Loading...</p>
                </div>
                <div class="stat-item">
                    <h3>Support Threshold</h3>
                    <p id="supportThreshold">Loading...</p>
                </div>
                <div class="stat-item">
                    <h3>Quorum</h3>
                    <p id="quorumPercentage">Loading...</p>
                </div>
                <div class="stat-item">
                    <h3>Max Proposal Age</h3>
                    <p id="maxProposalAge">Loading...</p>
                </div>
                <div class="stat-item">
                    <h3>Election Duration</h3>
                    <p id="electionDuration">Loading...</p>
                </div>
                <div class="stat-item">
                    <h3>Current Token Price</h3>
                    <p id="tokenPrice">Loading...</p>
                </div>
                <div class="stat-item">
                    <h3>Your Tokens</h3>
                    <p id="userTokens">Loading...</p>
                </div>
            </div>
        </section>

        <section id="tokenManagement" class="panel">
            <h2>Token Management</h2>
            <div class="token-actions">
                <div class="buy-tokens">
                    <h3>Buy Governance Tokens</h3>
                    <div class="form-group">
                        <label for="tokenAmount">Amount (ETH)</label>
                        <input type="number" id="tokenAmount" min="0" step="0.01">
                        <button id="buyTokensBtn">Purchase</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="createProposal" class="panel">
            <h2>Create a Proposal</h2>
            <div class="tabs">
                <button class="tab-btn active" data-tab="resolutionProposal">Resolution</button>
                <button class="tab-btn" data-tab="treasuryProposal">Treasury</button>
                <button class="tab-btn" data-tab="mintProposal">Mint Tokens</button>
                <button class="tab-btn" data-tab="tokenPriceProposal">Change Token Price</button>
            </div>
            
            <div id="resolutionProposal" class="tab-content active">
                <form id="resolutionForm">
                    <div class="form-group">
                        <label for="resolutionDescription">Description</label>
                        <textarea id="resolutionDescription" required></textarea>
                    </div>
                    <button type="submit">Create Resolution</button>
                </form>
            </div>
            
            <div id="treasuryProposal" class="tab-content">
                <form id="treasuryForm">
                    <div class="form-group">
                        <label for="treasuryDescription">Description</label>
                        <textarea id="treasuryDescription" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="treasuryRecipient">Recipient Address</label>
                        <input type="text" id="treasuryRecipient" required>
                    </div>
                    <div class="form-group">
                        <label for="treasuryAmount">Amount</label>
                        <input type="number" id="treasuryAmount" min="0" step="0.000001" required>
                    </div>
                    <div class="form-group">
                        <label for="treasuryToken">Token Address (0x0 for ETH)</label>
                        <input type="text" id="treasuryToken" required value="0x0000000000000000000000000000000000000000">
                    </div>
                    <div class="form-group">
                        <label for="treasuryTokenId">Token ID (0 for ETH/ERC20)</label>
                        <input type="number" id="treasuryTokenId" min="0" value="0" required>
                    </div>
                    <button type="submit">Create Treasury Proposal</button>
                </form>
            </div>
            
            <div id="mintProposal" class="tab-content">
                <form id="mintForm">
                    <div class="form-group">
                        <label for="mintDescription">Description</label>
                        <textarea id="mintDescription" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="mintRecipient">Recipient Address</label>
                        <input type="text" id="mintRecipient" required>
                    </div>
                    <div class="form-group">
                        <label for="mintAmount">Amount of Tokens</label>
                        <input type="number" id="mintAmount" min="1" step="1" required>
                    </div>
                    <button type="submit">Create Mint Proposal</button>
                </form>
            </div>
            
            <div id="tokenPriceProposal" class="tab-content">
                <form id="tokenPriceForm">
                    <div class="form-group">
                        <label for="priceDescription">Description</label>
                        <textarea id="priceDescription" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="newTokenPrice">New Token Price (Wei)</label>
                        <input type="number" id="newTokenPrice" min="0" step="1" required>
                    </div>
                    <button type="submit">Create Price Proposal</button>
                </form>
            </div>
        </section>

        <section id="activeProposals" class="panel">
            <h2>Active Proposals</h2>
            <div id="proposalsList" class="proposals-list">
                <p class="empty-message">Loading proposals...</p>
            </div>
        </section>

        <section id="activeElections" class="panel">
            <h2>Active Elections</h2>
            <div id="electionsList" class="elections-list">
                <p class="empty-message">Loading elections...</p>
            </div>
        </section>

        <section id="completedElections" class="panel">
            <h2>Completed Elections</h2>
            <div id="completedElectionsList" class="elections-list">
                <p class="empty-message">Loading past elections...</p>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>Market DAO - A Governance Concept. Bringing market forces to bear on group decisions.</p>
        </div>
    </footer>

    <div id="notification" class="notification hidden">
        <div class="notification-content">
            <span id="notificationMessage"></span>
            <button id="notificationClose">Ã—</button>
        </div>
    </div>

    <div id="modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 id="modalTitle">Modal Title</h2>
            <div id="modalContent"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js" type="application/javascript"></script>
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/contracts.js"></script>
    <script src="js/wallet.js"></script>
    <script src="js/dao.js"></script>
    <script src="js/proposals.js"></script>
    <script src="js/ui.js"></script>
    <!-- Make sure all dependencies are loaded before main.js -->
    <script>
        // Ensure all scripts are loaded before executing main.js
        document.addEventListener('DOMContentLoaded', () => {
            // Make sure all our objects exist before running main.js
            if (typeof wallet !== 'undefined' && 
                typeof contracts !== 'undefined' && 
                typeof daoManager !== 'undefined' && 
                typeof proposalManager !== 'undefined' && 
                typeof uiManager !== 'undefined') {
                
                // Now load main.js dynamically
                const mainScript = document.createElement('script');
                mainScript.src = 'js/main.js';
                document.body.appendChild(mainScript);
            } else {
                console.error('One or more required objects are not defined:',
                    { wallet: typeof wallet, 
                      contracts: typeof contracts, 
                      daoManager: typeof daoManager, 
                      proposalManager: typeof proposalManager, 
                      uiManager: typeof uiManager });
            }
        });
    </script>
</body>
</html>
